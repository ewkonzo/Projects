package com.wizarpos.util;

import android.graphics.Bitmap;
import android.os.Environment;
import android.util.Log;

import com.google.zxing.PlanarYUVLuminanceSource;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * Created by gecx on 16-11-9.
 */

public class BitmapUtils {

    private static final String TAG = BitmapUtils.class.getSimpleName();

    public static void bitmapSave(byte[] data, int width, int height) {
        PlanarYUVLuminanceSource source = new PlanarYUVLuminanceSource(data, width, height, 0, 0, width, height, false);
        if (source != null) {
            int[] pixels = source.renderThumbnail();
            int width2 = source.getThumbnailWidth();
            int height2 = source.getThumbnailHeight();
            Bitmap bitmap = Bitmap.createBitmap(pixels, 0, width2, width2, height2, Bitmap.Config.ARGB_8888);
            saveToSdCard(bitmap);
        }
    }

    public static void saveToSdCard(Bitmap bitmap) {
        SimpleDateFormat format = new SimpleDateFormat("yyyyMMddHHmmss");
        String filename = format.format(new Date()) + ".jpg";
        File fileFolder = new File(Environment.getExternalStorageDirectory() + "/Pictures/");
        Log.e(TAG, "fileName = " + filename + "\npath = " + fileFolder);
        if (!fileFolder.exists()) {
            fileFolder.mkdir();
        }
        File jpgFile = new File(fileFolder, filename);
        if (jpgFile.exists()) {
            jpgFile.delete();
        }
        FileOutputStream outputStream = null;
        try {
            outputStream = new FileOutputStream(jpgFile);
            bitmap.compress(Bitmap.CompressFormat.JPEG, 90, outputStream);
            outputStream.flush();
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                outputStream.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
